

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/ZHQBlog.github.io.git/img/fluid.png">
  <link rel="icon" href="/ZHQBlog.github.io.git/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="倔强的小强">
  <meta name="keywords" content="倔强的小强">
  
    <meta name="description" content="MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="https://github.com/ZHQBlog/2021/01/30/MySQL/index.html">
<meta property="og:site_name" content="小强的博客">
<meta property="og:description" content="MySQL">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230725522.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230403970.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230523842.png">
<meta property="og:image" content="https://dot-grill-f98.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F050ac75a-59c7-4787-a78d-97b29e8991bf%2FUntitled.png?table=block&id=85c87d1a-bfae-4711-a62e-9c4e3db7ad63&spaceId=65247838-fa1c-443f-8939-5945fc1748c5&width=1950&userId=&cache=v2">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230638657.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230653825.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230725522.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230801923.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230806064.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230843770.png">
<meta property="og:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230859968.png">
<meta property="article:published_time" content="2021-01-30T05:47:47.000Z">
<meta property="article:modified_time" content="2022-05-28T13:13:38.052Z">
<meta property="article:author" content="倔强的小强">
<meta property="article:tag" content="倔强的小强">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://github.com/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230725522.png">
  
  
  <title>MySQL - 小强的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/ZHQBlog.github.io.git/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/ZHQBlog.github.io.git/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/ZHQBlog.github.io.git/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"github.com","root":"/ZHQBlog.github.io.git/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/ZHQBlog.github.io.git/local-search.xml"};
  </script>
  <script  src="/ZHQBlog.github.io.git/js/utils.js" ></script>
  <script  src="/ZHQBlog.github.io.git/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/ZHQBlog.github.io.git/">
      <strong>❤</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/ZHQBlog.github.io.git/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/ZHQBlog.github.io.git/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/ZHQBlog.github.io.git/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/ZHQBlog.github.io.git/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/ZHQBlog.github.io.git/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/ZHQBlog.github.io.git/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MySQL"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-01-30 13:47" pubdate>
          2021年1月30日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          39k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          323 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL</h1>
            
            <div class="markdown-body">
              
              <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>windows中服务的启动和关闭：net stop mysql、net start mysql</p>
<p>Linux中<strong>启动/关闭mysql</strong><br>service mysqld start<br>service mysqld stop<br>service mysqld restart</p>
<p>登录：mysql -u用户名 -p  输入密码</p>
<p>​            mysql -h ip地址 -u用户名 -p 输入密码</p>
<p>退出：exit</p>
<h3 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h3><p>创建数据库语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE database;<br></code></pre></td></tr></table></figure>

<p>展示所有数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> DATABASES;<br></code></pre></td></tr></table></figure>

<p>使用指定数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">USE database;<br></code></pre></td></tr></table></figure>

<p>创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student(<br>    s_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">PRIMARY</span> KEY COMMENT<span class="hljs-string">&#x27;学生学号&#x27;</span>,<br>    s_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;学生姓名 不能为空&#x27;</span>,<br>    s_sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT<span class="hljs-string">&#x27;学生性别&#x27;</span>,<br>    s_birthday DATETIME COMMENT<span class="hljs-string">&#x27;学生生日&#x27;</span>,<br>    s_class <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT<span class="hljs-string">&#x27;学生所在的班级&#x27;</span><br>);<br></code></pre></td></tr></table></figure>

<p>展示表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DESCRIBE</span> <span class="hljs-keyword">table</span>;<br></code></pre></td></tr></table></figure>

<img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230725522.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230725522">



<h3 id="对表的数据操作"><a href="#对表的数据操作" class="headerlink" title="对表的数据操作"></a>对表的数据操作</h3><h4 id="查看操作"><a href="#查看操作" class="headerlink" title="查看操作"></a>查看操作</h4><p>查看表中的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span>;<br></code></pre></td></tr></table></figure>

<h4 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>...);<br></code></pre></td></tr></table></figure>

<h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> cow <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPDATE <span class="hljs-keyword">table</span> <span class="hljs-keyword">SET</span> cow1 <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">WHERE</span> cow2 <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#x27;</span>;<br></code></pre></td></tr></table></figure>



<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><p>能够唯一确定表中的一条记录。我们通过给某个字段添加该约束，就可以使得该字段不重复且不为空。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> (<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)<br>);<br></code></pre></td></tr></table></figure>

<h4 id="联合主键"><a href="#联合主键" class="headerlink" title="联合主键"></a>联合主键</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user2 (<br>	id <span class="hljs-type">INT</span>,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    <span class="hljs-keyword">PRIMARY</span> KEY(id, name)<br>);<br></code></pre></td></tr></table></figure>

<p>此处字段id和name一同作为主键，联合主键要求每个字段<strong>加起来不同即可</strong>（无需每个字段都不同）</p>
<h4 id="建表后添加主键"><a href="#建表后添加主键" class="headerlink" title="建表后添加主键"></a>建表后添加主键</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">ALERT <span class="hljs-keyword">TABLE</span> user2 <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY (id);<br></code></pre></td></tr></table></figure>

<p>或者通过<strong>修改字段</strong>的方式来添加主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">ALERT <span class="hljs-keyword">TABLE</span> user2 MODIFY id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY;<br></code></pre></td></tr></table></figure>

<h4 id="建表后删除主键"><a href="#建表后删除主键" class="headerlink" title="建表后删除主键"></a>建表后删除主键</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">ALERT <span class="hljs-keyword">TABLE</span> user2 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PRIMARY</span> KEY (id);<br></code></pre></td></tr></table></figure>

<h3 id="自增约束"><a href="#自增约束" class="headerlink" title="自增约束"></a>自增约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user3 (<br>	id <span class="hljs-type">INT</span> AUTO_INCREAMENT,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> user3 (name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span>插入成功，自动生成了id<br></code></pre></td></tr></table></figure>

<p>自增约束一般<strong>与主键搭配使用</strong></p>
<h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><p>约束修饰的字段不可以重复</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">UNIQUE</span>,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)<br>);<br></code></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (<br>	id <span class="hljs-type">INT</span>,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	<span class="hljs-keyword">UNIQUE</span>(id, name)<br>);<br></code></pre></td></tr></table></figure>

<h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>);<br></code></pre></td></tr></table></figure>

<h3 id="默认约束"><a href="#默认约束" class="headerlink" title="默认约束"></a>默认约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user4 (<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>);<br></code></pre></td></tr></table></figure>

<p>如果我们插入字段时没有传值，就会<strong>使用默认值</strong></p>
<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>主表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> master(<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)<br>);<br></code></pre></td></tr></table></figure>

<p>从表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> pet(<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	master_id <span class="hljs-type">int</span>,<br>	<span class="hljs-keyword">FOREIGN</span> KEY(master_id) <span class="hljs-keyword">REFERENCES</span> master(id)<br>);<br></code></pre></td></tr></table></figure>

<ul>
<li>主表中没有的数据，在副表中是不可以使用的</li>
<li>主表中的数据被副标引用时，是不可以删除的</li>
</ul>
<h2 id="数据库的三大范式"><a href="#数据库的三大范式" class="headerlink" title="数据库的三大范式"></a>数据库的三大范式</h2><h3 id="多表之间的关系"><a href="#多表之间的关系" class="headerlink" title="多表之间的关系"></a>多表之间的关系</h3><h4 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h4><p>可以在任意一方建立外键，指向一方的主键</p>
<h4 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h4><p>在多的一个方建立外键，指向一的一方的主键</p>
<h4 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h4><p>多对多关系的实现需要借助第三张中间表，中间表至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表的主键</p>
<p><strong>函数依赖</strong>：如果通过A属性（属性组）的值可以唯一确定B属性的值，则称B依赖于A</p>
<p><strong>完全函数依赖</strong>：如果A是一个属性组，则B属性值的确定需要依赖于A属性组中的所有属性值</p>
<p><strong>部分函数依赖</strong>：如果A是一个属性组，则B属性值的确定值需要依赖于A属性组中的某一些属性值</p>
<p><strong>传递函数依赖</strong>：如果通过A属性（属性组）的值可以唯一确定B属性的值，在通过B属性（属性组）的值可以唯一确定C属性的值，则称C传递函数依赖于A</p>
<p><strong>码</strong>：如果一张表中，一个属性或属性组，被其他所有属性所完全依赖，则称该属性（属性组）为该表的码</p>
<p><strong>主属性</strong>：码属性组中的所有属性</p>
<p><strong>非主属性</strong>：除码属性组的其他属性</p>
<h3 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h3><p><strong>数据库表的每一列都是不可分割的基本数据项，同一列中不能有多个值</strong></p>
<p>建表如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student(<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCRAEMENT,<br>	name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	province <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	city <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	area <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	street: <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)<br>);<br></code></pre></td></tr></table></figure>

<p>就是<strong>符合第一范式</strong>的，但<strong>并不是拆分的越详细越好</strong></p>
<h3 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h3><ul>
<li>满足第一范式的条件下，第二范式要求：<strong>除主键外的每一列，都必须完全依赖于主键[ 消除部分函数依赖 ]</strong></li>
<li>如果出现不完全依赖，则只可能发生在<strong>联合主键</strong>的情况下</li>
</ul>
<p><strong>不满足第二范式的例子</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">order</span>(<br>	product_id <span class="hljs-type">INT</span>,<br>	customer_id <span class="hljs-type">INT</span>,<br>	product_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>	customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    <span class="hljs-keyword">PRIMARY</span> KEY(product_id, customer_id)<br>);<br></code></pre></td></tr></table></figure>

<p>此处product_name只依赖于product_id，customer_name只依赖于customer_id，是部分函数依赖</p>
<h3 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h3><p><strong>满足第二范式，除主键外的其他列之间不能有传递依赖关系[消除传递函数依赖]</strong></p>
<p><strong>不满足第三范式的例子</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">order</span>(<br>	id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>	product_id <span class="hljs-type">INT</span>,<br>	customer_id <span class="hljs-type">INT</span>,<br>	customer_phone <span class="hljs-type">INT</span><br>);<br></code></pre></td></tr></table></figure>

<p>此处customer_phone又依赖于customer_id，存在传递依赖关系，不满足第三范式</p>
<h2 id="查询练习"><a href="#查询练习" class="headerlink" title="查询练习"></a>查询练习</h2><ul>
<li>查询student表中所有记录的s_name,s_sex和s_class列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no,s_name,s_class <span class="hljs-keyword">FROM</span>  student;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询教师所有的单位但是不重复的t_depart列——DISTINCT(列名)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(t_depart) <span class="hljs-keyword">FROM</span> teacher;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询score表中成绩在60-80之间所有的记录(sc_degree)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">60</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">80</span>;<br><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-number">60</span> <span class="hljs-keyword">AND</span> sc_degree <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询score表中成绩为85, 86, 或者88的记录(sc_degree)——IN(结果集合)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-keyword">IN</span>(<span class="hljs-number">85</span>, <span class="hljs-number">86</span>, <span class="hljs-number">88</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询student表中’95031’班或者性别为’女’的同学记录——OR</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span> <span class="hljs-keyword">OR</span> s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>以sc_degree降序查询score表中所有的记录——ORDER BY 列名 DESC</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询’95031’班的学生人数——COUNT(*)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询score表中的最高分数的学生号和课程号——MAX(列名)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, c_no <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(sc_degree) <span class="hljs-keyword">FROM</span> score);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询每门课的平均成绩——AVG(列名)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询score表中至少有2名学生选修的,并且以3开头的课程的平均分——GROUP BY 列名 HAVING 条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c_no <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(c_no) <span class="hljs-operator">&gt;=</span><span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> c_no <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;3%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有的学生 s_name , c_no, sc_degree列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, c_no, sc_degree <span class="hljs-keyword">FROM</span> student, score <span class="hljs-keyword">WHERE</span> student.s_no <span class="hljs-operator">=</span> score.s_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有学生的s_no, c_name, sc_degree列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_no, c_name, sc_degree <span class="hljs-keyword">FROM</span> student, score, course <span class="hljs-keyword">WHERE</span> student.s_no <span class="hljs-operator">=</span> score.s_no <span class="hljs-keyword">AND</span> score.c_no <span class="hljs-operator">=</span> course.c_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有的学生 s_name , c_name, sc_degree列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, c_name, sc_degree <span class="hljs-keyword">FROM</span> student, score, course <span class="hljs-keyword">WHERE</span> student.s_no <span class="hljs-operator">=</span> score.s_no <span class="hljs-keyword">AND</span> score.c_no <span class="hljs-operator">=</span> course.c_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询班级是’95031’班学生每门课的平均分</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> s_no <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span>) <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>(c_no);<br><br><span class="hljs-keyword">SELECT</span> c_no, <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">ON</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c_no;<br><br><span class="hljs-comment">--查询内容包含课程名（c_name）</span><br><span class="hljs-keyword">SELECT</span> c.c_no, c.c_name, <span class="hljs-built_in">AVG</span>(sc.sc_degree) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, course <span class="hljs-keyword">AS</span> c, score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">AND</span> sc.c_no <span class="hljs-operator">=</span> c.c_no <span class="hljs-keyword">AND</span> s.s_class <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;95031&#x27;</span>  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c.c_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询选修”3-105”课程的成绩高于’109’号同学’3-105’成绩 的所有同学的记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, score <span class="hljs-keyword">AS</span> sc <span class="hljs-keyword">WHERE</span> sc.sc_degree <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;109&#x27;</span> <span class="hljs-keyword">AND</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span>) <span class="hljs-keyword">AND</span> sc.c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span> <span class="hljs-keyword">AND</span> s.s_no <span class="hljs-operator">=</span> sc.s_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有与学号为108.101的同学同年出生的所有学生的s_no,s_name和s_birthday</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(s_birthday) <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">YEAR</span>(s_birthday) <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;101&#x27;</span>, <span class="hljs-string">&#x27;108&#x27;</span>));<br></code></pre></td></tr></table></figure>

<ul>
<li>查询 张旭 教师任课的学生的成绩</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name, sc.sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> sc, student <span class="hljs-keyword">AS</span> s <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> c_no <span class="hljs-keyword">FROM</span> course <span class="hljs-keyword">WHERE</span> t_no <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t_no <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张旭&#x27;</span>)) <span class="hljs-keyword">AND</span> s.s_no <span class="hljs-operator">=</span> sc.s_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询95033班和95031班全体学生的记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_class <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;95033&#x27;</span>, <span class="hljs-string">&#x27;95031&#x27;</span>) <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s_class;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询存在85分以上成绩的c_name和对应的老师</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t_name, c_name <span class="hljs-keyword">FROM</span> course <span class="hljs-keyword">AS</span> c, teacher <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> c_no <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-number">85</span>) <span class="hljs-keyword">AND</span> c.t_no <span class="hljs-operator">=</span> t.t_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查出所有’计算机系’ 教师所教课程的教师信息、课程信息及学生信息</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>  <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">AS</span> t, course <span class="hljs-keyword">AS</span> c, student <span class="hljs-keyword">AS</span> s, score <span class="hljs-keyword">AS</span> sc <br><span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <br><span class="hljs-keyword">AND</span> c.t_no <span class="hljs-operator">=</span> t.t_no <br><span class="hljs-keyword">AND</span> sc.c_no <span class="hljs-operator">=</span> c.c_no <br><span class="hljs-keyword">AND</span> t.t_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_no <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;计算机系&#x27;</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询’计算机系’与’电子工程系’ 不同职称的教师的name和rof</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;计算机系&#x27;</span> <br><span class="hljs-keyword">AND</span> t_rof <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_rof <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;电子工程系&#x27;</span>)<br><span class="hljs-keyword">UNION</span> <br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;电子工程系&#x27;</span> <br><span class="hljs-keyword">AND</span> t_rof <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_rof <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_depart <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;计算机系&#x27;</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询选修编号为”3-105”课程且成绩<strong>至少</strong>高于选修编号为’3-245’同学的c_no,s_no和sc_degree,并且按照sc_degree从高到地次序排序</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span> <span class="hljs-keyword">AND</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ANY</span>(<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-245&#x27;</span>) <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询选修编号为”3-105”且成绩高于选修编号为”3-245”课程的同学c_no.s_no和sc_degree</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-105&#x27;</span> <br><span class="hljs-keyword">AND</span> sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span>(<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-245&#x27;</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查出学生的信息,课程名称,分数(s_name c_name,sc_degree)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name, c.c_name, sc.sc_degree <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, course <span class="hljs-keyword">AS</span> c, score <span class="hljs-keyword">AS</span> sc<br><span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no<br><span class="hljs-keyword">AND</span> c.c_no <span class="hljs-operator">=</span> sc.c_no<br><span class="hljs-keyword">AND</span> sc.sc_degree <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span>(<span class="hljs-keyword">SELECT</span> sc_degree <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3-245&#x27;</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sc_degree <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>

<p>总结:</p>
<ul>
<li><p>ANY 和 ALL</p>
<ul>
<li>ANY:表示任何一个就行了,如;数组A中的值比数组B中任何一个都要大,那么只要A和B中最小的比较就行了</li>
<li>ALL:表示所有都要比较,如:数组A中的值比数组B中所有的数都要大,那么A要和B中最大的值比较才行</li>
</ul>
</li>
<li><p>查询所有教师和同学的 name ,sex, birthday</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, s_sex, s_birthday <span class="hljs-keyword">FROM</span> student<br><span class="hljs-keyword">UNION</span><br><span class="hljs-keyword">SELECT</span> t_name, t_sex, t_birthday <span class="hljs-keyword">FROM</span> teacher;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有’女’教师和’女’学生的name,sex,birthday</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name, s_sex, s_birthday <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span><br><span class="hljs-keyword">UNION</span><br><span class="hljs-keyword">SELECT</span> t_name, t_sex, t_birthday <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询成绩比该课程平均成绩低的同学的成绩表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> a <span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">WHERE</span> a.c_no <span class="hljs-operator">=</span> b.c_no);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询成绩比该课程平均成绩低的同学的成绩表，并显示出学生name,课程name以及分数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name <span class="hljs-keyword">AS</span> 学生姓名, c.c_name <span class="hljs-keyword">AS</span> 课程名, a.sc_degree <span class="hljs-keyword">AS</span> 成绩  <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> a, student <span class="hljs-keyword">AS</span> s, course <span class="hljs-keyword">AS</span> c <br><span class="hljs-keyword">WHERE</span> sc_degree <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sc_degree) <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">WHERE</span> a.c_no <span class="hljs-operator">=</span> b.c_no)<br><span class="hljs-keyword">AND</span> s.s_no <span class="hljs-operator">=</span> a.s_no<br><span class="hljs-keyword">AND</span> c.c_no <span class="hljs-operator">=</span> a.c_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有任课教师的t_name 和 t_depart(要在分数表中可以查得到)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">WHERE</span> t_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> t_no <span class="hljs-keyword">FROM</span> course <span class="hljs-keyword">WHERE</span> c_no <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> c_no <span class="hljs-keyword">FROM</span> score));<br></code></pre></td></tr></table></figure>

<ul>
<li>查出至少有2名男生的班号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_class <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span> <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> s_class <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(s_no) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询student 表中 不姓”王”的同学的记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;王%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询student 中每个学生的姓名和年龄(当前时间 - 出生年份)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name <span class="hljs-keyword">AS</span> 姓名, (<span class="hljs-keyword">YEAR</span>(NOW())<span class="hljs-operator">-</span><span class="hljs-keyword">YEAR</span>(s_birthday)) <span class="hljs-keyword">AS</span> 年龄 <span class="hljs-keyword">FROM</span> student;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询student中最大和最小的 s_birthday的值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(s_birthday), <span class="hljs-built_in">MIN</span>(s_birthday) <span class="hljs-keyword">FROM</span> student;<br></code></pre></td></tr></table></figure>

<ul>
<li>以班级号和年龄从大到小的顺序查询student表中的全部记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s_class <span class="hljs-keyword">DESC</span>, (<span class="hljs-keyword">YEAR</span>(NOW()) <span class="hljs-operator">-</span> <span class="hljs-keyword">YEAR</span>(s_birthday)) <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询”男”教师 及其所上的课</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t.t_name, c.c_name <span class="hljs-keyword">FROM</span> teacher <span class="hljs-keyword">AS</span> t, course <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">WHERE</span> t.t_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span>  <span class="hljs-keyword">AND</span> t.t_no <span class="hljs-operator">=</span> c.t_no;<br></code></pre></td></tr></table></figure>

<ul>
<li>查询最高分同学的s_no c_no 和 sc_degree;</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_no <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> s_no <span class="hljs-keyword">FROM</span> score <span class="hljs-keyword">WHERE</span> sc_degree  <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(sc_degree) <span class="hljs-keyword">FROM</span> score));<br></code></pre></td></tr></table></figure>

<ul>
<li>查询和”李军”同性别的所有同学的s_name</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span>  (<span class="hljs-keyword">SELECT</span> s_sex <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李军&#x27;</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询和”李军”同性别并且同班的所有同学的s_name</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s_name <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_sex <span class="hljs-operator">=</span>  (<span class="hljs-keyword">SELECT</span> s_sex <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李军&#x27;</span>)<br><span class="hljs-keyword">AND</span> s_class <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> s_class <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> s_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李军&#x27;</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>查询所有选修’计算机导论’课程的’男’同学的成绩表，并显示出s_name,c_name</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.s_name, c.c_name, sc.sc_degree <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">AS</span> s, score <span class="hljs-keyword">AS</span> sc, course <span class="hljs-keyword">AS</span> c <br><span class="hljs-keyword">WHERE</span> s.s_no <span class="hljs-operator">=</span> sc.s_no <span class="hljs-keyword">AND</span> c.c_no <span class="hljs-operator">=</span> sc.c_no <br><span class="hljs-keyword">AND</span> c.c_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;计算机导论&#x27;</span><br><span class="hljs-keyword">AND</span> s.s_sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span>;<br></code></pre></td></tr></table></figure>



<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p><strong>没有创建外键时，可以使用内外查询将两个表的内容合并在一起查询</strong></p>
<h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...<br></code></pre></td></tr></table></figure>

<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">AS</span> p <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> card  <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">ON</span> p.card_id <span class="hljs-operator">=</span> c.id;<br></code></pre></td></tr></table></figure>

<p><strong>内联查询：两张表通过某个字段合并起来，查询出相关数据</strong></p>
<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><h5 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...<br>或<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...<br></code></pre></td></tr></table></figure>

<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">AS</span> p <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> card <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">ON</span> p.card_id <span class="hljs-operator">=</span> c.id;<br>或者<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">AS</span> p <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> card <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">ON</span> p.card_id <span class="hljs-operator">=</span> c.id;<br></code></pre></td></tr></table></figure>

<p><strong>左外连接：</strong></p>
<ul>
<li>会把左表里的所有数据都取出来</li>
<li>对于右表，如果有数据就取出，如果没有就为空</li>
</ul>
<h5 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...<br>或<br><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...<br></code></pre></td></tr></table></figure>

<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">AS</span> p <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> card <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">ON</span> p.card_id <span class="hljs-operator">=</span> c.id;<br>或<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">AS</span> p <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> card <span class="hljs-keyword">AS</span> c <span class="hljs-keyword">ON</span> p.card_id <span class="hljs-operator">=</span> c.id;<br></code></pre></td></tr></table></figure>

<p><strong>右外连接</strong></p>
<ul>
<li>会把右表中的所有数据都取出来</li>
<li>对于左表，如果有数据就取出，如果没有就为空</li>
</ul>
<h5 id="三种连接的图解"><a href="#三种连接的图解" class="headerlink" title="三种连接的图解"></a>三种连接的图解</h5><img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230403970.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230403970" style="zoom:80%;">



<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>事务是一个最小的不可分割的单元，事务能够保证一个业务的完整性</p>
<p>多条sql语句<strong>要么同时成功，要么同时失败</strong></p>
<h3 id="自动提交、手动提交和回滚"><a href="#自动提交、手动提交和回滚" class="headerlink" title="自动提交、手动提交和回滚"></a>自动提交、手动提交和回滚</h3><p>通过**ROLLBACK;**指令可以回滚，但需要关闭自动提交</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">SET</span> autocommit <span class="hljs-comment">= 0</span><br>查看自动提交状态<br>SELECT <span class="hljs-comment">@@autocommit</span>;<br></code></pre></td></tr></table></figure>

<p>但如果在进行操作之后，执行提交事务**COMMIT;**则无法再进行回滚（持久化）</p>
<h3 id="手动开启事务"><a href="#手动开启事务" class="headerlink" title="手动开启事务"></a>手动开启事务</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span>;<br>或者<br><span class="hljs-keyword">START</span> TRANSACTION;<br></code></pre></td></tr></table></figure>

<h3 id="四大特征-ACID"><a href="#四大特征-ACID" class="headerlink" title="四大特征 ACID"></a>四大特征 ACID</h3><ul>
<li>原子性：事务是最小的单位，<strong>不可再分</strong></li>
<li>一致性：同一事务中的sql语句<strong>要么同时成功，要么同时失败</strong></li>
<li>隔离性：事务1和事务2之间具有隔离性</li>
<li>持久性：事物<strong>一旦结束</strong>（commit），就<strong>不可返回</strong>（rollback）</li>
</ul>
<h4 id="隔离性"><a href="#隔离性" class="headerlink" title="隔离性"></a>隔离性</h4><ul>
<li>事务的隔离级别<ul>
<li>读未提交 read uncommitted</li>
<li>读已提交 read committed</li>
<li>可以重复读 repeatable read</li>
<li>串行化 serializable</li>
</ul>
</li>
</ul>
<img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230523842.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230523842" style="zoom:80%;">

<ul>
<li>事务的并发问题<ul>
<li>脏读：事务A读取了事务B更新的数据，然后<strong>B回滚操作</strong>，那么<strong>A读取到的数据是脏数据</strong></li>
<li>不可重复读：事务 A 多次读取同一数据，事务B在事务A多次读取的过程中，对数据作了<strong>更新并提交</strong>，<strong>导致事务A多次读取同一数据时，结果不一致</strong></li>
<li>幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读</li>
</ul>
</li>
</ul>
<p><strong>总结</strong>：<strong>不可重复读侧重于修改，幻读侧重于新增或删除</strong></p>
<p> 解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表</p>
<ul>
<li>查看数据库的隔离级别</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">版本 <span class="hljs-number">5.</span>x<br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@global</span>.tx_isolation;<br><br>版本 <span class="hljs-number">8.0</span><br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@global</span>.transaction_isolation;<br></code></pre></td></tr></table></figure>

<ul>
<li>修改数据库的隔离级别</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> transaction isolation level read committed;<br></code></pre></td></tr></table></figure>



<h2 id="BeanUtils工具类"><a href="#BeanUtils工具类" class="headerlink" title="BeanUtils工具类"></a>BeanUtils工具类</h2><p>简化数据封装，用于封装javaBean的</p>
<h3 id="javaBean"><a href="#javaBean" class="headerlink" title="javaBean"></a>javaBean</h3><p>标准java类</p>
<ol>
<li>类必须被public修饰</li>
<li>必须提供空参public修饰的构造函数</li>
<li>成员变量必须使用private修饰</li>
<li>提供公共public修饰的setter和getter方法</li>
</ol>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>ssetter和getter方法截取后的产物，例如getUsername() —-username就是属性</p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><ol>
<li>setProperty() 设置bean的属性值      </li>
<li>getProperty()获取bean的属性值        </li>
<li>populate(Object obj, Map map)将map集合的键值对信息封装到JavaBean对象中</li>
</ol>
<p>注意：需要导入commons-beanutils-1.8.3.jar该包需要，两个jar包的支持：commons-collections-3.2.1.jar，commons-logging-1.1.1.jar</p>
<h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><h2 id="JDBC概述"><a href="#JDBC概述" class="headerlink" title="JDBC概述"></a>JDBC概述</h2><ul>
<li><p>JDBC(Java Database Connectivity)是一个<strong>独立于特定数据库管理系统、通用的SQL数据库存取和操作的公共接口</strong>（一组API），定义了用来访问数据库的标准Java类库，（<strong>java.sql,javax.sql</strong>）使用这些类库可以以一种<strong>标准</strong>的方法、方便地访问数据库资源。</p>
</li>
<li><p>JDBC的目标是使Java程序员使用JDBC可以连接任何<strong>提供了JDBC驱动程序</strong>的数据库系统，这样就使得程序员无需对特定的数据库系统的特点有过多的了解，从而大大简化和加快了开发过程。</p>
</li>
</ul>
<h3 id="两种思想"><a href="#两种思想" class="headerlink" title="两种思想"></a>两种思想</h3><h4 id="面向接口编程"><a href="#面向接口编程" class="headerlink" title="面向接口编程"></a>面向接口编程</h4><p>将数据库的实现类封装成接口，直接使用接口</p>
<h4 id="ORM编程思想"><a href="#ORM编程思想" class="headerlink" title="ORM编程思想"></a>ORM编程思想</h4><p>object relationship mapping 对象关系映射</p>
<p>一个数据表对应一个java类</p>
<p>表中一条记录对应java类的一个对象</p>
<p>表中一个字段对应java类的一个属性</p>
<h3 id="两种技术"><a href="#两种技术" class="headerlink" title="两种技术"></a>两种技术</h3><h4 id="ResultSetMetaData元数据"><a href="#ResultSetMetaData元数据" class="headerlink" title="ResultSetMetaData元数据"></a>ResultSetMetaData元数据</h4><ol>
<li>getColumnCount()：获取列数</li>
<li>getColumnLabel()：获取列别名（没有别名获取的是列的名称）</li>
</ol>
<h4 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h4><ol>
<li>创建对应运行时类的对象——newIncentive()</li>
<li>在运行时，动态的调用指定运行时类的属性，方法</li>
</ol>
<h3 id="数据库与SQL类型转化"><a href="#数据库与SQL类型转化" class="headerlink" title="数据库与SQL类型转化"></a>数据库与SQL类型转化</h3><p><img src="https://dot-grill-f98.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F050ac75a-59c7-4787-a78d-97b29e8991bf%2FUntitled.png?table=block&id=85c87d1a-bfae-4711-a62e-9c4e3db7ad63&spaceId=65247838-fa1c-443f-8939-5945fc1748c5&width=1950&userId=&cache=v2" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="img"></p>
<h2 id="JDBC编写步骤"><a href="#JDBC编写步骤" class="headerlink" title="JDBC编写步骤"></a>JDBC编写步骤</h2><img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230638657.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230638657" style="zoom:80%;">



<p>ODBC(<strong>Open Database Connectivity</strong>，开放式数据库连接)，是微软在Windows平台下推出的。使用者在程序中只需要调用ODBC API，由 ODBC 驱动程序将调用转换成为对特定的数据库的调用请求。</p>
<h3 id="加载驱动到项目"><a href="#加载驱动到项目" class="headerlink" title="加载驱动到项目"></a>加载驱动到项目</h3><ul>
<li>在项目文件下创建lib文件夹，拷贝驱动文件到lib文件夹下</li>
<li>添加依赖：选中对应模块或者项目，将lib中的jar包添加到模块或者项目中</li>
</ul>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test5</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>	<span class="hljs-comment">//1. 通过类加载器 获取 数据库文件中的配置信息</span><br>	ClassLoader loader = JDBCTest1.class.getClassLoader();<br>	InputStream is = loader.getResourceAsStream(<span class="hljs-string">&quot;jdbcTest.properties&quot;</span>);<br>	Properties info = <span class="hljs-keyword">new</span> Properties();<br>	info.load(is);<br>	String user = info.getProperty(<span class="hljs-string">&quot;user&quot;</span>);<br>	String password = info.getProperty(<span class="hljs-string">&quot;password&quot;</span>);<br>	String url = info.getProperty(<span class="hljs-string">&quot;url&quot;</span>);<br>	String driver = info.getProperty(<span class="hljs-string">&quot;driver&quot;</span>);<br><br>	<span class="hljs-comment">//2. 通过反射加载驱动类</span><br>	Class.forName(driver);<br>	<span class="hljs-comment">//3. 连接数据库</span><br>	Connection con = DriverManager.getConnection(url, user, password);<br>	System.out.println(con);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>配置文件<strong>Properties</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/ks</span><br><span class="hljs-attr">user</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">4213</span><br><span class="hljs-attr">driver</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></td></tr></table></figure>

<p><strong>好处</strong>：实现了代码与数据库连接信息的分离，解耦 ；如果需要修改配置文件信息，可以避免程序重新打包</p>
<h2 id="JDBC相关操作"><a href="#JDBC相关操作" class="headerlink" title="JDBC相关操作"></a>JDBC相关操作</h2><h3 id="JDBC相关类"><a href="#JDBC相关类" class="headerlink" title="JDBC相关类"></a>JDBC相关类</h3><h4 id="DriverManager"><a href="#DriverManager" class="headerlink" title="DriverManager"></a>DriverManager</h4><p>驱动管理对象</p>
<p>作用：</p>
<ol>
<li>注册驱动：告诉程序使用哪个数据库驱动jar（一般使用Class.forName(“驱动”)）</li>
<li>获取数据库连接：DriverManager.getConnection(String url, String user, String password)</li>
</ol>
<h4 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h4><p>数据库连接对象</p>
<ol>
<li>获取执行sql语句的对象：connection.createStatement()或connection.prepareStatement(String sql)</li>
<li>管理事务：<ol>
<li>开启事务：setAutoCommit(false)</li>
<li>提交事务：commit()</li>
<li>回滚事务：rollback()</li>
</ol>
</li>
</ol>
<h4 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a>ResultSet</h4><p>结果集对象，封装查询结果</p>
<ol>
<li>resultSet.next()：游标向下移动</li>
<li>resultSet.getXxx()：获取数据</li>
</ol>
<h4 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h4><ul>
<li>通过调用 Connection 对象的 createStatement() 方法创建该对象。该对象用于执行静态的 SQL 语句，并且返回执行结果。</li>
<li>Statement 接口中定义了下列方法用于执行 SQL 语句：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">excuteUpdate</span><span class="hljs-params">(String sql)</span>：执行更新操作INSERT、UPDATE、DELETE</span><br><span class="hljs-function">ResultSet <span class="hljs-title">executeQuery</span><span class="hljs-params">(String sql)</span>：执行查询操作SELECT</span><br></code></pre></td></tr></table></figure>

<ul>
<li>但是使用Statement操作数据表存在弊端：</li>
</ul>
<h5 id="问题一：存在拼串操作，繁琐"><a href="#问题一：存在拼串操作，繁琐" class="headerlink" title="问题一：存在拼串操作，繁琐"></a><strong>问题一：存在拼串操作，繁琐</strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">String <span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> &quot;SELECT user,password FROM user_table WHERE USER = &#x27;&quot; <span class="hljs-operator">+</span> userName <span class="hljs-operator">+</span> &quot;&#x27; AND PASSWORD = &#x27;&quot; <span class="hljs-operator">+</span> password <span class="hljs-operator">+</span> &quot;&#x27;&quot;;<br></code></pre></td></tr></table></figure>

<h5 id="问题二：存在SQL注入问题"><a href="#问题二：存在SQL注入问题" class="headerlink" title="问题二：存在SQL注入问题"></a><strong>问题二：存在SQL注入问题</strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">#<span class="hljs-keyword">user</span>:<span class="hljs-number">1</span><span class="hljs-string">&#x27; OR </span><br><span class="hljs-string">#password:=&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; = &#x27;</span><span class="hljs-number">1</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">USER</span>,PASSWORD <span class="hljs-keyword">FROM</span> user_table <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">USER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">OR</span> <span class="hljs-string">&#x27; AND PASSWORD = &#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">OR</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure>

<p>对于 Java 而言，要防范 SQL 注入，只要用 PreparedStatement 取代 Statement 就可以了。</p>
<h4 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h4><p>PreparedStatement 是一个特殊的Statement对象</p>
<h5 id="PreparedStatement对比Statement"><a href="#PreparedStatement对比Statement" class="headerlink" title="PreparedStatement对比Statement"></a>PreparedStatement对比Statement</h5><ul>
<li>拼串和SQL注入的问题</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1.Statement中，直接输入SQL语句进行执行，就会出现SQL注入问题</span><br>SELECT USER,PASSWORD FROM user_table WHERE USER = <span class="hljs-string">&#x27;1&#x27;</span> OR <span class="hljs-string">&#x27; AND PASSWORD = &#x27;</span>=<span class="hljs-string">&#x27;1&#x27;</span> OR <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span><br><br><span class="hljs-comment">//2.在PreparStatement中则是先进行SQL的预编译, 使用占位符，不用拼串，后续填充占位符，也不会改变SQL原有的逻辑，解决SQL注入</span><br>String sql = <span class="hljs-string">&quot;SELECT * FROM admin WHERE username = ? AND PASSWORD = ?;&quot;</span>;<br>PreparedStatement ps = conn.prepareStatement(sql);<br></code></pre></td></tr></table></figure>

<ul>
<li><p>Statement无法操作Blob类型的数据</p>
</li>
<li><p>repaerStatement便于批量操作，Statement批量操作：执行一次SQL语句，需要校验一次SQL，repaerStatement批量操作：无论执行多少次SQL，都只校验一次，效率更高</p>
</li>
<li><p><strong>PreparedStatement 能最大可能提高性能：</strong>语句在被DBServer的编译器编译后的执行代码被缓存下来，下次调用时只要是相同的预编译语句就不需要编译，只要将参数直接传入编译过的语句执行代码中就会得到执行。</p>
</li>
</ul>
<h4 id="ResultSetMetaData"><a href="#ResultSetMetaData" class="headerlink" title="ResultSetMetaData"></a>ResultSetMetaData</h4><p>结果集的元数据：ResultSetMetaData rsmd = res.getMetaData();</p>
<p>获取列数：</p>
<p>​    int columnCount = rsmd.getColumnCount();</p>
<p> 获取列名：</p>
<p>​    String columnName = rsmd.getColumnLabel(i + 1);</p>
<h3 id="CURD操作"><a href="#CURD操作" class="headerlink" title="CURD操作"></a>CURD操作</h3><ul>
<li>数据库连接被用于向数据库服务器发送命令和 SQL 语句，并接受数据库服务器返回的结果。其实一个数据库连接就是一个Socket连接。</li>
<li>在 java.sql 包中有 3 个接口分别定义了对数据库的调用的不同方式：<ul>
<li>Statement：用于执行静态 SQL 语句并返回它所生成结果的对象。</li>
<li>PrepatedStatement：SQL 语句被预编译并存储在此对象中，可以使用此对象多次高效地执行该语句。</li>
<li>CallableStatement：用于执行 SQL 存储过程</li>
</ul>
</li>
</ul>
<img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230653825.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230653825" style="zoom:80%;">

<h4 id="增-删-改：通用"><a href="#增-删-改：通用" class="headerlink" title="增/删/改：通用"></a>增/删/改：通用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commonUpdate</span><span class="hljs-params">(String sql, Object... args)</span></span>&#123;<br>    Connection conn = <span class="hljs-keyword">null</span>;<br>    PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//数据库建立连接</span><br>        conn = JDBCUtils.getConnection();<br>        <span class="hljs-comment">//预编译SQL</span><br>        ps = conn.prepareStatement(sql);<br>        <span class="hljs-comment">//填充占位符</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>            ps.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>        &#125;<br>        <span class="hljs-comment">//执行SQL</span><br>        ps.execute();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-comment">//关闭连接</span><br>        JDBCUtils.closeResource(conn,ps);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="查询：通用"><a href="#查询：通用" class="headerlink" title="查询：通用"></a>查询：通用</h4><ul>
<li><p>查询与增删改的区别，查询返回结果集ResultSet</p>
</li>
<li><p>使用next方法检查结果集中是否存在数据</p>
</li>
<li><p>有数据则指针下移看，指向数据，无数据则指针不下移</p>
<p>resultSet.next方法类似iterate.hasNext 与 iterate.next的功能综合版本，但是不会返回数据</p>
</li>
<li><p>是通过索引获取当前行的数据</p>
</li>
<li><p>推荐将存储到对象之中</p>
</li>
</ul>
<p><strong>针对单表进行查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Customer 表进行查询</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">CommonqueryTest</span><span class="hljs-params">(String sql,Object... args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		<span class="hljs-comment">//连接数据库</span><br>		Connection conn = JDBCUtils.getConnection();<br>		<span class="hljs-comment">//预编译SQL</span><br>		PreparedStatement ps = conn.prepareStatement(sql);<br>		<span class="hljs-comment">//填充占位符</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>			ps.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>		&#125;<br>		<span class="hljs-comment">//返回结果集</span><br>		ResultSet res = ps.executeQuery();<br>		<span class="hljs-comment">//获取结果集的元数据</span><br>		ResultSetMetaData rsmd = res.getMetaData();<br>    	<span class="hljs-comment">//获取结果集的列数</span><br>		<span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>		<span class="hljs-comment">//判断结果集中是否存在对象，将指针指向数据行</span><br>		<span class="hljs-keyword">if</span>(res.next())<br>		&#123;<br>			Customer customer = <span class="hljs-keyword">new</span> Customer();<br>			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>				<span class="hljs-comment">//获取列值</span><br>				Object columnValue = res.getObject(i + <span class="hljs-number">1</span>);<br>                <span class="hljs-comment">//获取列名（属性名）</span><br>				String columnName = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>				<span class="hljs-comment">//通过反射修改类的属性值</span><br>                <span class="hljs-comment">//反射类字段值</span><br>				Field field = Customer.class.getDeclaredField(columnName);<br>				<span class="hljs-comment">//访问私有字段</span><br>				field.setAccessible(<span class="hljs-keyword">true</span>);<br>				<span class="hljs-comment">//设置值</span><br>				field.set(customer,columnValue);<br>			&#125;<br>			<span class="hljs-keyword">return</span> customer;<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>	&#125;<br></code></pre></td></tr></table></figure>

<p><strong>针对通用表进行查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">CommonqueryTest2</span><span class="hljs-params">(Class&lt;T&gt; clazz, String sql,Object... args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		<span class="hljs-comment">//连接数据库</span><br>		Connection conn = JDBCUtils.getConnection();<br>		<span class="hljs-comment">//预编译</span><br>		PreparedStatement ps = conn.prepareStatement(sql);<br>		<span class="hljs-comment">//填充占位符</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>			ps.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>		&#125;<br>		<span class="hljs-comment">//查询获取结果集</span><br>		ResultSet res = ps.executeQuery();<br>		<span class="hljs-comment">//获取结果集的元数据</span><br>		ResultSetMetaData rsmd = res.getMetaData();<br>		<span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>		<span class="hljs-comment">//获取结果集</span><br>		<span class="hljs-keyword">if</span>(res.next())<br>		&#123;<br>			T t = clazz.newInstance();<br>			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>				<span class="hljs-comment">//获取列名、值</span><br>				Object columnValue = res.getObject(i + <span class="hljs-number">1</span>);<br>				String columnName = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>                <span class="hljs-comment">//getColumnLabel：先获取别名，没有别名获取字段名</span><br>				<span class="hljs-comment">//反射类字段值</span><br>				Field field = clazz.getDeclaredField(columnName);<br>				<span class="hljs-comment">//访问私有字段</span><br>				field.setAccessible(<span class="hljs-keyword">true</span>);<br>				<span class="hljs-comment">//设置值</span><br>				field.set(t,columnValue);<br>			&#125;<br>			<span class="hljs-keyword">return</span> t;<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>	&#125;<br></code></pre></td></tr></table></figure>

<p><strong>返回查询的集合</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">CommonqueryTest3</span><span class="hljs-params">(Class&lt;T&gt; clazz, String sql, Object... args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		<span class="hljs-comment">//连接数据库</span><br>		Connection conn = JDBCUtils.getConnection();<br>		<span class="hljs-comment">//预编译</span><br>		PreparedStatement ps = conn.prepareStatement(sql);<br>		<span class="hljs-comment">//填充占位符</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>			ps.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>		&#125;<br>		<span class="hljs-comment">//查询获取结果集</span><br>		ResultSet res = ps.executeQuery();<br>		<span class="hljs-comment">//获取结果集的元数据</span><br>		ResultSetMetaData rsmd = res.getMetaData();<br>		<span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>		ArrayList&lt;T&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		<span class="hljs-comment">//获取结果集</span><br>		<span class="hljs-keyword">while</span>(res.next())<br>		&#123;<br>			T t = clazz.newInstance();<br>			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>				<span class="hljs-comment">//获取列名、值</span><br>				Object columnValue = res.getObject(i + <span class="hljs-number">1</span>);<br>				String columnName = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>				<span class="hljs-comment">//反射类字段值</span><br>				Field field = clazz.getDeclaredField(columnName);<br>				<span class="hljs-comment">//访问私有字段</span><br>				field.setAccessible(<span class="hljs-keyword">true</span>);<br>				<span class="hljs-comment">//设置值</span><br>				field.set(t,columnValue);<br>			&#125;<br>			list.add(t);<br>		&#125;<br>		<span class="hljs-keyword">return</span> list;<br>	&#125;<br></code></pre></td></tr></table></figure>

<p>ResultSetMetaData ：结果集的元数据：对结果集进行描述的数据 </p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>根据ORM编程思想，数据库一行数据对应一个Java对象，数据库一个字段对应Java类的一个属性，所以当数据库字段与Java属性名不一致会报错</p>
<p><strong>数据库字段名要与Java类中属性名不一致：则必须在SQL语句中给字段起别名</strong></p>
<p><strong>思维导图</strong></p>
<p><img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230725522.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230725522" style="zoom:80%;"><img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230801923.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230801923"></p>
<h3 id="JDBCUtils工具类"><a href="#JDBCUtils工具类" class="headerlink" title="JDBCUtils工具类"></a>JDBCUtils工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCUtils</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>		<span class="hljs-comment">//通过类加载器 获取 数据库文件中的配置信息</span><br>		ClassLoader loader = ClassLoader.getSystemClassLoader();<br>		InputStream is = loader.getResourceAsStream(<span class="hljs-string">&quot;jdbc.properties&quot;</span>);<br>		Properties info = <span class="hljs-keyword">new</span> Properties();<br>		info.load(is);<br>		String user = info.getProperty(<span class="hljs-string">&quot;user&quot;</span>);<br>		String password = info.getProperty(<span class="hljs-string">&quot;password&quot;</span>);<br>		String url = info.getProperty(<span class="hljs-string">&quot;url&quot;</span>);<br>		String driver = info.getProperty(<span class="hljs-string">&quot;driver&quot;</span>);<br>		<span class="hljs-comment">//通过反射加载驱动类</span><br>		Class.forName(driver);<br>		<span class="hljs-comment">//连接数据库</span><br>		Connection con = DriverManager.getConnection(url, user, password);<br>		<span class="hljs-keyword">return</span> con;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeResource</span><span class="hljs-params">(Connection con, Statement ps, ResultSet re)</span> </span>&#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-keyword">if</span> (re != <span class="hljs-keyword">null</span>)<br>				re.close();<br>		&#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>			throwables.printStackTrace();<br>		&#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-keyword">if</span> (ps != <span class="hljs-keyword">null</span>)<br>				ps.close();<br>		&#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>			throwables.printStackTrace();<br>		&#125;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-keyword">if</span> (con != <span class="hljs-keyword">null</span>)<br>				con.close();<br>		&#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>			throwables.printStackTrace();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="操作Blob"><a href="#操作Blob" class="headerlink" title="操作Blob"></a>操作Blob</h3><ul>
<li><p>MySQL中，BLOB是一个二进制大型对象，是一个可以存储大量数据的容器，它能容纳不同大小的数据。</p>
</li>
<li><p>插入BLOB类型的数据必须使用PreparedStatement，因为BLOB类型的数据无法使用字符串拼接写的。</p>
</li>
<li><p>MySQL的四种BLOB类型(除了在存储的最大信息量上不同外，他们是等同的)</p>
<img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230806064.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230806064" style="zoom:80%;"></li>
<li><p>实际使用中根据需要存入的数据大小定义不同的BLOB类型。</p>
</li>
<li><p>需要注意的是：如果存储的文件过大，数据库的性能会下降。</p>
</li>
<li><p>如果在指定了相关的Blob类型以后，还报错：xxx too large，那么在mysql的安装目录下，找my.ini文件加上如下的配置参数：<strong>max_allowed_packet=16M</strong>。同时注意：修改了my.ini文件之后，需要重新启动mysql服务。</p>
</li>
</ul>
<h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> ~~<span class="hljs-keyword">throws</span> Exception~~ </span>&#123; <span class="hljs-comment">//正式应该使用Try catch进行操作</span><br>		Connection conn = JDBCUtils.getConnection();<br>        <span class="hljs-comment">//改使用update进行操作</span><br>		String sql = <span class="hljs-string">&quot;INSERT INTO customers(NAME,email,photo) VALUES(?,?,?);&quot;</span>;<br>		PreparedStatement ps = conn.prepareStatement(sql);<br>		ps.setObject(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Tom&quot;</span>);<br>		ps.setObject(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;Tom@163.com&quot;</span>);<br>		InputStream is = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;a1.jpg&quot;</span>));<br>		ps.setBlob(<span class="hljs-number">3</span>,is);<br>		ps.execute();<br>		is.close();<br>		JDBCUtils.closeResource(conn,ps);<br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> ~~<span class="hljs-keyword">throws</span> Exception~~ </span>&#123; <span class="hljs-comment">//正式应该使用Try catch进行操作</span><br>		Connection conn = JDBCUtils.getConnection();<br>		String sql = <span class="hljs-string">&quot;SELECT NAME,email,photo FROM customers WHERE id = ?;&quot;</span>;<br>		PreparedStatement ps = conn.prepareStatement(sql);<br>		ps.setObject(<span class="hljs-number">1</span>,<span class="hljs-number">27</span>);<br>		ResultSet rs = ps.executeQuery();<br>		<span class="hljs-keyword">if</span>(rs.next())&#123;<br>			String name = rs.getString(<span class="hljs-string">&quot;Name&quot;</span>);<br>			String email = rs.getString(<span class="hljs-string">&quot;email&quot;</span>);<br>			System.out.println(<span class="hljs-string">&quot;Name: &quot;</span> + name + <span class="hljs-string">&quot;email: &quot;</span> + email);<br><br>			<span class="hljs-comment">//将Blob类型的数据保存到本地</span><br>			Blob photo = rs.getBlob(<span class="hljs-string">&quot;photo&quot;</span>);<br>			InputStream is = photo.getBinaryStream();<br>			FileOutputStream fis = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;pic.jpg&quot;</span>));<br>			<span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>			<span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;<br>			<span class="hljs-keyword">while</span>((len = is.read(buffer)) != -<span class="hljs-number">1</span>)&#123;<br>				fis.write(buffer,<span class="hljs-number">0</span>,len);<br>			&#125;<br>			fis.close();<br>			is.close();<br>		&#125;<br>		JDBCUtils.closeResource(conn,ps);<br>	&#125;<br></code></pre></td></tr></table></figure>

<h3 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h3><h4 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h4><p>使用Statement进行批量添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    Connection conn = JDBCUtils.getConnection();<br>    Statement st = conn.createStatement();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;<br>        String sql = <span class="hljs-string">&quot;INSERT INTO goods(NAME) VALUES(&#x27;Jack_&quot;</span>+i+<span class="hljs-string">&quot;&#x27;)&quot;</span>;<br>        st.execute(sql);<br>    &#125;<br>    JDBCUtils.closeResource(conn,st);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h4><p>使用PrepaerStatement进行批量添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    Connection conn = JDBCUtils.getConnection();<br>    String sql = <span class="hljs-string">&quot;INSERT INTO goods(NAME) VALUES(?);&quot;</span>;<br>    PreparedStatement ps = conn.prepareStatement(sql);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;<br>        ps.setObject(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;jack_&quot;</span>+i);<br>        ps.execute();<br>    &#125;<br>    JDBCUtils.closeResource(conn,ps);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>方式一：每次都会创建字符串变量，并且对SQL进行检查 </p>
<p>方式二：创建SQL缓存，不会多次创建，只对SQL检查一次 </p>
<h4 id="方式三"><a href="#方式三" class="headerlink" title="方式三"></a>方式三</h4><p>通过将需要执行的SQL缓存下来，批量执行，提升效率，5.1.7之前不支持批处理</p>
<ul>
<li><p>使用 <strong>addBatch() / executeBatch() / clearBatch()</strong></p>
</li>
<li><p>mysql服务器默认是关闭批处理的，我们需要通过一个参数，让mysql开启批处理的支持。</p>
<p><code>?rewriteBatchedStatements=true</code> 写在配置文件的url后面</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test5</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    Connection conn = JDBCUtils.getConnection();<br>    String sql = <span class="hljs-string">&quot;INSERT INTO goods(NAME) VALUES(?)&quot;</span>;<br>    PreparedStatement ps = conn.prepareStatement(sql);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100000</span>; i++) &#123;<br>        ps.setObject(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;jack_&quot;</span>+i);<br>        <span class="hljs-comment">//缓存SQL</span><br>        ps.addBatch();<br>        <span class="hljs-keyword">if</span>(i%<span class="hljs-number">500</span> == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">//将缓存的SQL批量执行</span><br>            ps.executeBatch();<br>            <span class="hljs-comment">//清理缓存</span><br>            ps.clearBatch();<br>        &#125;<br>    &#125;<br>    JDBCUtils.closeResource(conn,ps);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="方式四"><a href="#方式四" class="headerlink" title="方式四"></a>方式四</h4><p>将自动提交事务关闭，全部SQL执行完毕之后再提交</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test6</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    Connection conn = JDBCUtils.getConnection();<br>    <span class="hljs-comment">//关闭事务自动提交</span><br>    conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>    String sql = <span class="hljs-string">&quot;INSERT INTO goods(NAME) VALUES(?)&quot;</span>;<br>    PreparedStatement ps = conn.prepareStatement(sql);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">1000000</span>; i++) &#123;<br>        ps.setObject(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;jack_&quot;</span>+i);<br>        ps.addBatch();<br>        <span class="hljs-keyword">if</span>(i%<span class="hljs-number">500</span> == <span class="hljs-number">0</span>)&#123;<br>            ps.executeBatch();<br>            ps.clearBatch();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//提交事务</span><br>    conn.commit();<br>    JDBCUtils.closeResource(conn,ps);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="JDBC事务"><a href="#JDBC事务" class="headerlink" title="JDBC事务"></a>JDBC事务</h2><ul>
<li>数据一旦提交，就不可回滚</li>
<li>哪些操作会导致数据的自动提交<ol>
<li>DDL操作一旦执行，就会自行提交 【set_autocommit = false 对DDL操作无效】</li>
<li>DML默认情况下一旦执行，就会自动提交</li>
<li>默认再关闭连接时，会自动的提交数据</li>
</ol>
</li>
</ul>
<h3 id="模拟事务"><a href="#模拟事务" class="headerlink" title="模拟事务"></a>模拟事务</h3><ul>
<li>调用 Connection 对象的 **setAutoCommit(false)**取消自动提交事务</li>
<li>在所有的 SQL 语句都成功执行后，调用 <strong>commit()</strong> 方法提交事务</li>
<li>在出现异常时，调用 <strong>rollback()</strong> 方法回滚事务</li>
<li>若此时 Connection 没有被关闭，还可能被重复使用，则需要恢复其自动提交状态 setAutoCommit(true)。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span></span>&#123;<br>    Connection conn = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//1. 获取连接</span><br>        conn = JDBCUtills.getConnection();<br>        <span class="hljs-comment">//2. 开启事务</span><br>        conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>        String sql1 = <span class="hljs-string">&quot;UPDATE user_table SET balance = 1100 WHERE USER = ?&quot;</span>;<br>        <span class="hljs-comment">//3. 进行数据库操作</span><br>        updateWithTx(conn,sql1,<span class="hljs-string">&quot;AA&quot;</span>);<br>        <span class="hljs-comment">//模拟网络异常</span><br>        System.out.println(<span class="hljs-number">10</span>/<span class="hljs-number">0</span>);<br>        String sql2 = <span class="hljs-string">&quot;UPDATE user_table SET balance = 900 WHERE USER = ?&quot;</span>;<br>        updateWithTx(conn,sql2,<span class="hljs-string">&quot;BB&quot;</span>);<br>        <span class="hljs-comment">//4.提交事务</span><br>        conn.commit();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//5.异常回滚</span><br>            conn.rollback();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>            throwables.printStackTrace();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//6.恢复DML自动提交,主要针对数据库连接池</span><br>            conn.setAutoCommit(<span class="hljs-keyword">true</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>            throwables.printStackTrace();<br>        &#125;<br>        <span class="hljs-comment">//7.关闭资源</span><br>        JDBCUtills.closeResource(conn,<span class="hljs-keyword">null</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//通用更新操作，再updateWithTx方法之中不要进行数据库的关闭 数据库连接的关闭会导致事务自动提交</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateWithTx</span><span class="hljs-params">(Connection conn,String sql, Object... args)</span></span>&#123;<br>    PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        ps = conn.prepareStatement(sql);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>            ps.setObject(i+<span class="hljs-number">1</span>,args[i]);<br>        &#125;<br>        ps.execute();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">finally</span> &#123;<br>        JDBCUtills.closeResource(<span class="hljs-keyword">null</span>,ps);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Oracle 支持的 2 种事务隔离级别：<strong>READ COMMITED</strong>, SERIALIZABLE，默认的事务隔离级别为: <strong>READ COMMITED</strong></li>
<li>Mysql 支持 4 种事务隔离级别：Mysql 默认的事务隔离级别为: REPEATABLE READ</li>
</ul>
<h3 id="隔离级别问题"><a href="#隔离级别问题" class="headerlink" title="隔离级别问题"></a>隔离级别问题</h3><img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230843770.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230843770" style="zoom:80%;">

<h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p> T2在T1读取数据的时候，对数据进行了更新，后续对数据进行了回滚操作 所以T1在后续的两次读取中看到的数据并不相同.</p>
<h4 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h4><p>当T1第一次读取数据时与第二次读取数据中间的时间 T2对数据进行了更新，并且提交 然后T1再对数据进行读取，发现两次数据并不一致。</p>
<h4 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h4><p>当T1第一次读取数据后，T2插入了一条新数据，并且提交 T1再对数据进行了更新，发现受影响行数与第一次读取到数据行数不一致</p>
<h2 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h2><h3 id="Dao相关实现类"><a href="#Dao相关实现类" class="headerlink" title="Dao相关实现类"></a>Dao相关实现类</h3><ul>
<li>DAO：Data Access Object访问数据信息的类和接口，包括了对数据的CRUD，而不包含任何业务相关的信息。有时也称作：BaseDAO</li>
<li>作用：为了实现功能的模块化，更有利于代码的维护和升级</li>
</ul>
<h3 id="BaseDao的实现"><a href="#BaseDao的实现" class="headerlink" title="BaseDao的实现"></a>BaseDao的实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*通用的增删改查操作</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseDao</span> </span>&#123;<br>    <span class="hljs-comment">//事务通用多条数据查询</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">getInstance</span><span class="hljs-params">(Connection conn, Class&lt;T&gt; clazz, String sql, Object... args)</span> </span>&#123;<br>        List&lt;T&gt; list = <span class="hljs-keyword">null</span>;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        ResultSet rs = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            rs = ps.executeQuery();<br>            ResultSetMetaData rsmd = rs.getMetaData();<br>            <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>            list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>            <span class="hljs-keyword">while</span> (rs.next()) &#123;<br>                T t = clazz.newInstance();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>                    String columnLabel = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>                    Object value = rs.getObject(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">//反射类所有字段，并且赋值</span><br>                    Field field = clazz.getDeclaredField(columnLabel);<br>                    field.setAccessible(<span class="hljs-keyword">true</span>);<br>                    field.set(t, value);<br>                &#125;<br>                list.add(t);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception throwables) &#123;<br>            throwables.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtills.closeResource(<span class="hljs-keyword">null</span>, ps, rs);<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-comment">//事务通用更新</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getUpdate</span><span class="hljs-params">(Connection conn, String sql, Object... args)</span> </span>&#123;<br>        List&lt;T&gt; list = <span class="hljs-keyword">null</span>;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">int</span> row = -<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            row = ps.executeUpdate();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception throwables) &#123;<br>            throwables.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtills.closeResource(<span class="hljs-keyword">null</span>, ps);<br>            <span class="hljs-keyword">return</span> row;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//事务通用一条数据查询</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getValue</span><span class="hljs-params">(Connection conn, String sql, Object... args)</span> </span>&#123;<br>        Object val = <span class="hljs-keyword">null</span>;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        ResultSet rs = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = conn.prepareStatement(sql);<br>            val = <span class="hljs-keyword">null</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            rs = ps.executeQuery();<br>            <span class="hljs-keyword">if</span> (rs.next()) &#123;<br>                val = rs.getObject(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>            throwables.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtills.closeResource(<span class="hljs-keyword">null</span>, ps, rs);<br>        &#125;<br>        <span class="hljs-keyword">return</span> (T) val;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Dao接口"><a href="#Dao接口" class="headerlink" title="Dao接口"></a>Dao接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomerDao</span> </span>&#123;<br><br>    <span class="hljs-comment">//将cust对象添加到数据库之中</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Connection conn, Customer cust)</span></span>;<br><br>    <span class="hljs-comment">//根据id号删除数据库中customer数据</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Connection conn, <span class="hljs-keyword">int</span> id)</span></span>;<br>    <br>    <span class="hljs-comment">//根据id号修改数据库中customer数据</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateById</span><span class="hljs-params">(Connection conn,Customer cust, <span class="hljs-keyword">int</span> id)</span></span>;<br><br>    <span class="hljs-comment">//根据id号查詢数据库中customer数据</span><br>    <span class="hljs-function">Customer <span class="hljs-title">getCustomerById</span><span class="hljs-params">(Connection conn, <span class="hljs-keyword">int</span> id)</span></span>;<br><br>    <span class="hljs-comment">//查询数据库customer表中所有的数据</span><br>    <span class="hljs-function">List&lt;Customer&gt; <span class="hljs-title">getAll</span><span class="hljs-params">(Connection conn)</span></span>;<br><br>    <span class="hljs-comment">//查询数据库customer表中所有的行数</span><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getCount</span><span class="hljs-params">(Connection conn)</span></span>;<br><br>    <span class="hljs-comment">//查询数据库customer表中年龄最大的生日</span><br>    <span class="hljs-function">Date <span class="hljs-title">getMaxBirth</span><span class="hljs-params">(Connection conn)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Dao接口实现类"><a href="#Dao接口实现类" class="headerlink" title="Dao接口实现类"></a>Dao接口实现类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomerDao</span></span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Connection conn, Customer cust)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;insert into customers(name,email,birth) values(?,?,?)&quot;</span>;<br>        getUpdate(conn,sql,cust.getName(),cust.getEmial(),cust.getBirth());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Connection conn, <span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;delete from customers where id = ?&quot;</span>;<br>        getUpdate(conn,sql,id);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateById</span><span class="hljs-params">(Connection conn, Customer cust, <span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;update customers set name = ?, email = ?, birth = ? where id = ?&quot;</span>;<br>        getUpdate(conn,sql,cust.getName(),cust.getEmial(),cust.getBirth(),id);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">getCustomerById</span><span class="hljs-params">(Connection conn, <span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select name, email, birth from customers where id = ?&quot;</span>;<br>        List&lt;Customer&gt; list = getInstance(conn, Customer.class, sql, id);<br>        <span class="hljs-keyword">return</span> list.size() &gt; <span class="hljs-number">0</span> ? list.get(<span class="hljs-number">0</span>) :<span class="hljs-keyword">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Customer&gt; <span class="hljs-title">getAll</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select name, email, birth from customers&quot;</span>;<br>        List&lt;Customer&gt; list = getInstance(conn, Customer.class, sql);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getCount</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select count(*) from customers&quot;</span>;<br>        <span class="hljs-keyword">return</span>  getValue(conn,sql);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getMaxBirth</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select max(birth) from customers&quot;</span>;<br>        <span class="hljs-keyword">return</span> getValue(conn,sql);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><strong>BaseDao</strong>：实现对表的通用操作：通用增删改查</p>
<p><strong>Dao接口</strong>：实现对于某个表的的抽象方法</p>
<p><strong>Dao接口实现类</strong>：实现接口中的抽象方法</p>
<p>BaseDao类中增删改查的方法，没有关闭conn的操作 conn关闭会自动提交事务</p>
<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2><p>数据库连接池技术</p>
<ul>
<li><p><strong>数据库连接池的基本思想</strong>：为数据库连接建立一个“缓冲池”。预先在缓冲池中放入一定数量的连接，当需要建立数据库连接时，只需从“缓冲池”中取出一个，使用完毕之后再放回去。</p>
</li>
<li><p><strong>数据库连接池</strong>负责分配、管理和释放数据库连接，它<strong>允许应用程序重复使用一个现有的数据库连接，而不是重新建立一个</strong>。</p>
</li>
<li><p>数据库连接池在初始化时将创建一定数量的数据库连接放到连接池中，这些数据库连接的数量是由<strong>最小数据库连接数来设定</strong>的。无论这些数据库连接是否被使用，连接池都将一直保证至少拥有这么多的连接数量。连接池的<strong>最大数据库连接数量</strong>限定了这个连接池能占有的最大连接数，当应用程序向连接池请求的连接数超过最大连接数量时，这些请求将被加入到等待队列中。</p>
</li>
<li><p>工作原理</p>
</li>
</ul>
<img src="/ZHQBlog.github.io.git/ZHQBlog/2021/01/30/MySQL/image-20220402230859968.png" srcset="/ZHQBlog.github.io.git/img/loading.gif" lazyload alt="image-20220402230859968" style="zoom:80%;">

<p><strong>数据库连接池技术的优点</strong></p>
<ol>
<li>提高程序的响应速度（减少创建连接的响应时间）</li>
<li>降低资源的消耗（重复使用已经创建好的连接）</li>
<li>便于连接的管理</li>
</ol>
<p><strong>多种开源的数据库连接池</strong></p>
<ul>
<li>JDBC 的数据库连接池使用 javax.sql.DataSource 来表示，DataSource 只是一个接口，该接口通常由服务器(Weblogic, WebSphere, Tomcat)提供实现，也有一些开源组织提供实现：<ul>
<li><strong>DBCP</strong> 是Apache提供的数据库连接池。tomcat 服务器自带dbcp数据库连接池。<strong>速度相对c3p0较快</strong>，但因自身存在BUG，Hibernate3已不再提供支持。</li>
<li><strong>C3P0</strong> 是一个开源组织提供的一个数据库连接池，速度相对较慢，稳定性还可以。hibernate官方推荐使用</li>
<li><strong>Proxool</strong> 是sourceforge下的一个开源项目数据库连接池，有监控连接池状态的功能，<strong>稳定性较c3p0差一点</strong></li>
<li><strong>BoneCP</strong> 是一个开源组织提供的数据库连接池，速度快</li>
<li><strong>Druid</strong> 是阿里提供的数据库连接池，据说是集DBCP 、C3P0 、Proxool 优点于一身的数据库连接池，但是速度不确定是否有BoneCP快</li>
</ul>
</li>
<li><strong>DataSource</strong> 通常被称为数据源，它包含连接池和连接池管理两个部分，习惯上也经常把 DataSource 称为连接池，DataSource用来取代DriverManager来获取Connection，获取速度快，同时可以大幅度提高数据库访问速度。</li>
<li>特别注意：<ul>
<li>数据源和数据库连接不同，数据源无需创建多个，它是产生数据库连接的工厂，因此<strong>整个应用只需要一个数据源即可。</strong></li>
<li>当数据库访问结束后，程序还是像以前一样关闭数据库连接：conn.close(); 但conn.close()并没有关闭数据库的物理连接，它仅仅把数据库连接释放，归还给了数据库连接池。</li>
</ul>
</li>
</ul>
<h3 id="c3p0数据库连接池"><a href="#c3p0数据库连接池" class="headerlink" title="c3p0数据库连接池"></a>c3p0数据库连接池</h3><p>连接方式1：不推荐</p>
<ol>
<li>加载启动，导入c3p0的jar包</li>
<li>c3p0连接数据库</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ComboPooledDataSource cpds = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br>        cpds.setDriverClass( <span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> ); <span class="hljs-comment">//loads the jdbc driver</span><br>        cpds.setJdbcUrl( <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span> );<br>        cpds.setUser(<span class="hljs-string">&quot;root&quot;</span>);<br>        cpds.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br><br>        <span class="hljs-comment">//设置数据库连接池</span><br>        <span class="hljs-comment">//设置初始化数据库连接池的连接数</span><br>        cpds.setInitialPoolSize(<span class="hljs-number">10</span>);<br>        <br>        Connection conn = cpds.getConnection();<br><br>		<span class="hljs-comment">//销毁c3p0连接池，一般不销毁</span><br>        <span class="hljs-comment">//DataSources.destroy( cpds );</span><br>    &#125;<br></code></pre></td></tr></table></figure>

<p>连接方式2：推荐  使用xml配置文件连接</p>
<p>c3p0-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">c3p0-config</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- This app is massive! --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">named-config</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;C3po&quot;</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/test<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- 涉及到数据库连接池的管理的相关属性的设置 --&gt;</span><br>        <span class="hljs-comment">&lt;!-- 若数据库中连接数不足时, 一次向数据库服务器申请多少个连接 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;acquireIncrement&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 初始化数据库连接池时连接的数量 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;initialPoolSize&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 数据库连接池中的最小的数据库连接数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;minPoolSize&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 数据库连接池中的最大的数据库连接数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxPoolSize&quot;</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- C3P0 数据库连接池可以维护的 Statement 的个数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxStatements&quot;</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 每个连接同时可以使用的 Statement 对象的个数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxStatementsPerConnection&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">named-config</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c3p0-config</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//数据库连接池-饿汉式</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ComboPooledDataSource cpds = <span class="hljs-keyword">new</span> ComboPooledDataSource(<span class="hljs-string">&quot;C3po&quot;</span>);<br><span class="hljs-comment">//返回连接</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>    Connection conn = cpds.getConnection();<br>    <span class="hljs-keyword">return</span> conn;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>💡创建c3p0-config.xml配置文件的方式进行数据库的连接，c3p0-config.xml配置文件创建在src项目根目录下会自动加载配置文件</p>
<h3 id="dbcp数据库连接池"><a href="#dbcp数据库连接池" class="headerlink" title="dbcp数据库连接池"></a>dbcp数据库连接池</h3><ul>
<li>加载驱动，导入dbcp的jar包</li>
<li>dbcp依赖pool，需要导入pool的jar包</li>
</ul>
<p>方式一：硬编码，不推荐</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>    <span class="hljs-comment">//创建dbcp的数据库连接池</span><br>    BasicDataSource source = <span class="hljs-keyword">new</span> BasicDataSource();<br>    source.setDriverClassName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>    source.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>    source.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>    source.setUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);<br>    <span class="hljs-comment">//设置数据库连接池</span><br>    source.setInitialSize(<span class="hljs-number">10</span>);<br>    source.setMaxActive(<span class="hljs-number">10</span>);<br><br>    Connection conn = source.getConnection();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>方式二：配置文件，推荐</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//读取properties配置文件</span><br>    InputStream is = ClassLoader.getSystemResourceAsStream(<span class="hljs-string">&quot;dbcp2.properties&quot;</span>);<br>    Properties info = <span class="hljs-keyword">new</span> Properties();<br>    info.load(is);<br>    <span class="hljs-comment">//创建dbcp的数据库连接池</span><br>    DataSource source = BasicDataSourceFactory.createDataSource(info);<br>    Connection conn = source.getConnection();<br>    System.out.println(conn);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="⭐druid数据库连接池"><a href="#⭐druid数据库连接池" class="headerlink" title="⭐druid数据库连接池"></a>⭐druid数据库连接池</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">driverClassName</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/ks</span><br><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">4213</span><br><span class="hljs-comment">##初始化连接数量</span><br><span class="hljs-attr">initialSize</span>=<span class="hljs-string">5</span><br><span class="hljs-comment">##最大连接数量</span><br><span class="hljs-attr">maxActive</span>=<span class="hljs-string">10</span><br><span class="hljs-comment">##最大等待时间</span><br><span class="hljs-attr">maxWait</span>=<span class="hljs-string">3000</span><br></code></pre></td></tr></table></figure>

<ul>
<li>加载驱动，导入druid的jar包</li>
<li>方式一：不推荐，硬编码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        DruidDataSource source = <span class="hljs-keyword">new</span> DruidDataSource();<br>        <span class="hljs-comment">//硬编码加载</span><br>        source.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>        source.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>        source.setUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);<br>        source.setDriverClassName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br><br>        <span class="hljs-comment">//多态调用连接方法</span><br>        DataSource s1 = source;<br>        Connection conn = s1.getConnection();<br>        System.out.println(conn);<br>    &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>方式二：推荐，配置文件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        Properties info = <span class="hljs-keyword">new</span> Properties();<br>        <span class="hljs-comment">//类加载器</span><br>        InputStream is = ClassLoader.getSystemResourceAsStream(<span class="hljs-string">&quot;dbcp.properties&quot;</span>);<br>        info.load(is);<br>        DataSource source = DruidDataSourceFactory.createDataSource(info);<br>        Connection conn = source.getConnection();<br>        System.out.println(conn);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="Spring-JDBC"><a href="#Spring-JDBC" class="headerlink" title="Spring JDBC"></a>Spring JDBC</h3><p>提供了一个JDBCTemplate对象</p>
<ol>
<li><p>导入jar包</p>
</li>
<li><p>创建jdbcTemplate对象，依赖数据源DataSource</p>
<p>jdbcTemplate template = new jdbcTemplate(ds);</p>
</li>
<li><p>调用jdbctemplate的方法是来完成操作，直接执行sql语句</p>
<p>update(sql, ?, ?)：执行增删改操作</p>
<p>queryForMap()：查询结果将结果封装为Map集合；查询的结果只能为1</p>
<p>queryForList()：查询结果将结果封装为List集合；将查询的每个结果封装为Map集合</p>
<p>query()：将结果封装为JavaBean对象；利用BeanPropertyRowMapper实现类</p>
<p>queryForObject()：将结果封装为对象</p>
</li>
</ol>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>相比c3p0、dbcp数据库连接池，更加推荐druid</p>
</li>
<li><p>获取数据库连接池的方法时，推荐使用单例模式（饱汉式/饿汉式）</p>
</li>
<li><p>注意：如果在servlet中使用数据库连接池，要将数据库连接池的jar包导入到WEB-INF目录下的lib目录中，因为servler项目部署到Tomcat服务器中</p>
<p>1）src 下的源文件（如：.java）经过了编译之后放在 WEB-INF/classes 目录下</p>
<p>2）lib 包在编译前需要放在 WEB-INF 下编译后才能出现在 WEB-INF/lib 目录下，所以除了 tomcat 自带的 jar 包（JRE）外，项目所需 jar 包都应放在 WEB-INF 的 lib 目录下，否则部署的web项目就会缺少lib包</p>
</li>
</ul>
<h1 id="Apache-DBUtils"><a href="#Apache-DBUtils" class="headerlink" title="Apache-DBUtils"></a>Apache-DBUtils</h1><p>使用PreparedStatement对CURD进行封装，底层一致，导入dbutils的jar包</p>
<ul>
<li>主要使用到QueryRunner、ResultSetHandler<T>这两个类</T></li>
<li>获取QueryRunner类：<strong>QueryRunner runner = new QueryRunner();</strong><ul>
<li><strong>query</strong>方法，是用来做查询的         (connection，sql，对象，参数)</li>
<li><strong>update</strong>方法，用来做增删改操作</li>
<li><strong>batch</strong>方法，用来做批处理</li>
</ul>
</li>
</ul>
<h3 id="ResultSetHandler接口及实现类"><a href="#ResultSetHandler接口及实现类" class="headerlink" title="ResultSetHandler接口及实现类"></a>ResultSetHandler接口及实现类</h3><ul>
<li><p>该接口用于处理 java.sql.ResultSet，将数据结果集按要求转换为另一种形式。</p>
</li>
<li><p>ResultSetHandler 可以理解为接收结果的</p>
</li>
<li><p>接口的主要实现类：</p>
<ul>
<li>ArrayHandler：把结果集中的第一行数据转成对象数组。</li>
<li>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中。</li>
<li>BeanHandler：将结果集中的第一行数据封装到一个对应的JavaBean实例中。</li>
<li>BeanListHandler：将结果集中的每一行数据都封装到一个对应的JavaBean实例中，存放到List里。</li>
<li>ColumnListHandler：将结果集中某一列的数据存放到List中。</li>
<li>KeyedHandler(name)：将结果集中的每一行数据都封装到一个Map里，再把这些map再存到一个map里，其key为指定的key。</li>
<li>MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值。</li>
<li>MapListHandler：将结果集中的每一行数据都封装到一个Map里，然后再存放到List</li>
<li>ScalarHandler：查询单个值对象</li>
</ul>
<p>ArrayHandler：把结果集中的第一行数据转成Object数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Object[] result = runner.query(con, sql, <span class="hljs-keyword">new</span> ArrayHandler());<br>    <span class="hljs-keyword">for</span>(Object obj : result)&#123;<br>   		 System.out.print(obj);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Object[]&gt; result=  runner.query(con, sql, <span class="hljs-keyword">new</span> ArrayListHandler());<br>	<span class="hljs-comment">//集合的遍历</span><br>    <span class="hljs-keyword">for</span>( Object[] objs  : result)&#123;<br>    	<span class="hljs-comment">//遍历对象数组</span><br>        <span class="hljs-keyword">for</span>(Object obj : objs)&#123;<br>            System.out.print(obj+<span class="hljs-string">&#x27;  &#x27;</span>);<br>        &#125;<br>    	System.out.println();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>BeanHandler：将结果集中的第一行数据封装到一个对应的JavaBean对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Sort s = runner.query(con, sql, <span class="hljs-keyword">new</span> BeanHandler&lt;Sort&gt;(Sort.class));<br>System.out.println(s);<br></code></pre></td></tr></table></figure>




<p>BeanListHandler：将结果集中的每一行数据都封装到一个对应的JavaBean对象中，存放到List集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Sort&gt; list = runner.query(con, sql, <span class="hljs-keyword">new</span> BeanListHandler&lt;Sort&gt;(Sort.class));<br>	<span class="hljs-keyword">for</span>(Sort s : list)&#123;<br>   		System.out.println(s);<br>&#125;<br></code></pre></td></tr></table></figure>




<p>ColumnListHandler： 结果集指定列的数据,存储到List集合 List 每个列数据类型不同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Object&gt; list = runner.query(con,sql,<span class="hljs-keyword">new</span> ColumnListHandler&lt;Object&gt;(<span class="hljs-string">&#x27;id&#x27;</span>));<br>    <span class="hljs-keyword">for</span>(Object obj :list)&#123;<br>    	System.out.println(obj);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ScalarHandler: 对于查询后,只有1个结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">long</span> count = runner.query(con, sql, <span class="hljs-keyword">new</span> ScalarHandler&lt;Object&gt;());<br>System.out.println(count);<br></code></pre></td></tr></table></figure>



<p>MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, Object&gt; map = runner.query(con, sql, <span class="hljs-keyword">new</span> MapHandler());<br>   <span class="hljs-comment">//遍历Map集合</span><br>   <span class="hljs-keyword">for</span>(String key : map.keySet())&#123;<br>    	System.out.println(key+<span class="hljs-string">&#x27;..&#x27;</span>+map.get(key));<br>&#125;<br></code></pre></td></tr></table></figure>



<p>MapListHandler：将结果集中的每一行数据都封装到一个Map里，然后再存放到List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Map&lt;String, Object&gt;&gt; list = runner.query(con,sql,<span class="hljs-keyword">new</span> MapListHandler());<br><span class="hljs-comment">//遍历集合list</span><br>	<span class="hljs-keyword">for</span>(Map map :list)&#123;<br>   		<span class="hljs-keyword">for</span>(String key : map.keySet())&#123;<br>      		System.out.print(key+<span class="hljs-string">&#x27;...&#x27;</span>+map.get(key));<br>   	&#125;<br>    System.out.println();<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">//Druid连接池</span><br>        Connection conn = source.getConnection();<br>        <span class="hljs-comment">//DBUtills</span><br>        QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br>        String sql = <span class="hljs-string">&quot;insert into user_table values(?,?,?)&quot;</span>;<br>        <span class="hljs-keyword">int</span> res = runner.update(conn, sql, <span class="hljs-string">&quot;jack1&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-number">2000</span>);<br>        System.out.println(<span class="hljs-string">&quot;insert successed&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h3><p><strong>查询单条记录</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * 测试查询:查询一条记录</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * 使用ResultSetHandler的实现类：BeanHandler</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">querySingleTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>      <span class="hljs-comment">//Druid连接池</span><br>      Connection conn = source.getConnection();<br>   <span class="hljs-comment">//DBUtills</span><br>      QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br><br>      <span class="hljs-comment">//查询单条结果</span><br>      String sql = <span class="hljs-string">&quot;SELECT * FROM customers WHERE id = ?&quot;</span>;<br>      BeanHandler&lt;Customer&gt; handler = <span class="hljs-keyword">new</span> BeanHandler(Customer.class);<br>      Customer customer = runner.query(conn, sql, handler, <span class="hljs-number">1</span>);<br>      System.out.println(customer);<br><br><span class="hljs-comment">//释放连接到资源池</span><br>      JDBCUtills.closeResource(conn,<span class="hljs-keyword">null</span>);<br>  &#125;    <br></code></pre></td></tr></table></figure>

<p><strong>查询多条记录</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* 测试查询:查询多条记录构成的集合</span><br><span class="hljs-comment">* 使用ResultSetHandler的实现类：BeanListHandler</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryMultipleTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//Druid连接池</span><br>    Connection conn = source.getConnection();<br>    <span class="hljs-comment">//DBUtills</span><br>    QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br><br>    <span class="hljs-comment">//查询多条结果集</span><br>    String sql2 = <span class="hljs-string">&quot;SELECT * FROM customers&quot;</span>;<br>    BeanListHandler&lt;Customer&gt; listHandler = <span class="hljs-keyword">new</span> BeanListHandler(Customer.class);<br>    List&lt;Customer&gt; list = runner.query(conn, sql2, listHandler);<br>    list.forEach(System.out::println);<br><br>    <span class="hljs-comment">//释放连接到资源池</span><br>    JDBCUtills.closeResource(conn,<span class="hljs-keyword">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>查询单个值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 测试查询:查询单个值</span><br><span class="hljs-comment"> * 使用ResultSetHandler的实现类：ScalarHandler</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryValueTest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//Druid连接池</span><br>    Connection conn = source.getConnection();<br>    <span class="hljs-comment">//DBUtills</span><br>    QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br><br>    <span class="hljs-comment">//查询单条结果</span><br>    String sql = <span class="hljs-string">&quot;SELECT Count(*) FROM customers&quot;</span>;<br>    ScalarHandler handler = <span class="hljs-keyword">new</span> ScalarHandler();<br>    <span class="hljs-keyword">long</span> o = (<span class="hljs-keyword">long</span>) runner.query(conn, sql, handler);<br>    System.out.println(o);<br><br>    <span class="hljs-comment">//释放连接到资源池</span><br>    JDBCUtills.closeResource(conn,<span class="hljs-keyword">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="自定义Handler"><a href="#自定义Handler" class="headerlink" title="自定义Handler"></a>自定义Handler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-comment">//自定义resultHandler</span><br><span class="hljs-function"><span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>    <span class="hljs-comment">//Druid连接池</span><br>    Connection conn = source.getConnection();<br>    <span class="hljs-comment">//DBUtills</span><br>    QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br><br>    <span class="hljs-comment">//查询单条结果</span><br>    String sql = <span class="hljs-string">&quot;SELECT * FROM customers where id = 1&quot;</span>;<br>    ResultSetHandler&lt;Customer&gt; selfDefineHandler = <span class="hljs-keyword">new</span> ResultSetHandler&lt;Customer&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">handle</span><span class="hljs-params">(ResultSet resultSet)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>            ResultSetMetaData rsmd = resultSet.getMetaData();<br>            <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>            <span class="hljs-keyword">if</span>(resultSet.next())&#123;<br>                Customer cust = <span class="hljs-keyword">new</span> Customer();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>                    String columnLabel = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>                    Object value = resultSet.getObject(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        Field field = Customer.class.getDeclaredField(columnLabel);<br>                        field.setAccessible(<span class="hljs-keyword">true</span>);<br>                        field.set(cust,value);<br>                        <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                            e.printStackTrace();<br>                        &#125;<br>                        <span class="hljs-keyword">finally</span> &#123;<br>                            <span class="hljs-keyword">if</span>(resultSet!=<span class="hljs-keyword">null</span>)<br>                                resultSet.close();<br>                        &#125;      <br>                    &#125;<br>                    <span class="hljs-keyword">return</span> cust;<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>            &#125;<br>        &#125;;<br>        Customer query = runner.query(conn, sql, selfDefineHandler);<br>        System.out.println(query);<br><br>        <span class="hljs-comment">//释放连接到资源池</span><br>        JDBCUtills.closeResource(conn,<span class="hljs-keyword">null</span>);<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>自定义ResultSetHandler接口的实现类，实现Handler方法 核心handle方法就是处理ResultSet 结果集，自定义返回类型</p>
<h3 id="资源关闭"><a href="#资源关闭" class="headerlink" title="资源关闭"></a>资源关闭</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">(Connection con, Statement st, ResultSet rs)</span></span>&#123;<br>    <span class="hljs-comment">//方式1</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        DbUtils.close(con);<br>        DbUtils.close(st);<br>        DbUtils.close(rs);<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;<br>        throwables.printStackTrace();<br>    &#125;<br>    <span class="hljs-comment">//方式2</span><br>    DbUtils.closeQietly(rs);<br>&#125;<br></code></pre></td></tr></table></figure>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MySQL</div>
      <div>https://github.com/ZHQBlog/2021/01/30/MySQL/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>倔强的小强</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年1月30日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/ZHQBlog.github.io.git/2021/01/30/Maven/" title="Maven">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Maven</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/ZHQBlog.github.io.git/2020/12/02/JavaScript/" title="JavaScript">
                        <span class="hidden-mobile">JavaScript</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/ZHQBlog.github.io.git/js/events.js" ></script>
<script  src="/ZHQBlog.github.io.git/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/ZHQBlog.github.io.git/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/ZHQBlog.github.io.git/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/ZHQBlog.github.io.git/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
